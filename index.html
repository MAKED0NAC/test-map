<!DOCTYPE html>
<html lang="hr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
<title>DONAC</title>

<link rel="stylesheet"
href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
html, body {
  margin:0;
  padding:0;
  height:100%;
  overflow:hidden;
  background:#000;
}

#map {
  width:100vw;
  height:100vh;
}

.leaflet-control-zoom {
  display:none;
}

/* rotacija markera */
.rotating-marker img {
  transform-origin: center;
}
</style>
</head>
<body>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
const map = L.map('map', {
  zoomControl:false,
  attributionControl:false
}).setView([0,0], 20);

// dark mapa
L.tileLayer(
  'https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png'
).addTo(map);

// custom marker
const myIcon = L.icon({
  iconUrl: "https://docs.fivem.net/blips/radar_centre_red.png",
  iconSize: [40,40],
  iconAnchor: [20,20],
  className: "rotating-marker"
});

let marker;
let heading = 0;

// GPS tracking
navigator.geolocation.watchPosition(pos => {
  const lat = pos.coords.latitude;
  const lng = pos.coords.longitude;

  // heading iz GPS-a (kad se krećeš)
  if(pos.coords.heading !== null){
    heading = pos.coords.heading;
  }

  map.setView([lat,lng], 20, {animate:true});

  if(!marker){
    marker = L.marker([lat,lng], {icon:myIcon}).addTo(map);
  } else {
    marker.setLatLng([lat,lng]);
  }

  rotateMarker();

}, () => alert("Uključi GPS"), {
  enableHighAccuracy:true,
  maximumAge:1000,
  timeout:10000
});

// fallback kompas (telefon rotacija)
window.addEventListener("deviceorientation", e => {
  if(e.alpha !== null){
    heading = 360 - e.alpha;
    rotateMarker();
  }
});

function rotateMarker(){
  if(marker){
    const el = marker.getElement();
    if(el){
      const img = el.querySelector("img");
      if(img){
        img.style.transform = `rotate(${heading}deg)`;
      }
    }
  }
}

// fullscreen na klik
document.body.addEventListener("click", () => {
  document.documentElement.requestFullscreen?.();
}, {once:true});
</script>

</body>
</html>

